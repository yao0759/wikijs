---
title: slurm--调度配置指南
description: slurm中文翻译系列，机翻后纠正了一点，发现其他错误望指出，来源：https://github.com/SchedMD/slurm/blob/master/doc/html/sched_config.shtml
published: true
date: 2024-06-29T06:35:56.110Z
tags: slurm
editor: markdown
dateCreated: 2024-06-29T06:30:40.964Z
---

## 概述

Slurm 设计用于在作业提交或完成以及配置更改等事件中执行快速、简单的调度尝试。在这些事件触发的调度事件中，**default_queue_depth**（默认值为 100）会考虑作业数量。

在**sched_interval**定义的不太频繁的时间间隔内，所有作业都将被考虑进行调度。

无论哪种情况，一旦某个分区中的任何作业或作业阵列任务处于待处理状态，该分区中的其他作业都不会被调度。

更全面的调度尝试通常由backfill调度插件完成。

## 调度配置

**SchedulerType** 配置参数指定要使用的调度程序插件。选项包括 sched/backfill（执行backifill调度）和 sched/builtin（尝试在每个分区/队列中按严格的优先级顺序调度作业）。

此外，还有一个 **SchedulerParameters** 配置参数，可指定下文所述的各种参数。第一组参数适用于所有调度配置。详情请参见 [slurm.conf(5)](https://slurm.schedmd.com/slurm.conf.html) 手册。

- **default_queue_depth=#** - 指定在每个可能导致作业被调度的事件中考虑调度的作业数量。默认值为 100 个作业。由于这种情况经常发生，一般来说，作业数最好相对较少。
- **defer** - 提交时不尝试单独调度作业。这对高吞吐量计算很有用。
- **max_switch_wait=#** - 指定作业等待所需叶开关数量的最长时间。默认值为 300 秒。
- **partition_job_depth=#** - 指定在任何单个分区中测试多少个作业，默认值为 0（无限制）。
- **sched_interval=#** - 指定主调度循环执行和测试所有待处理作业的频率（以秒为单位）。默认值为 60 秒。

## Backfill调度 

默认情况下已加载backifill调度插件。如果没有backifill调度，每个分区都会严格按照优先级顺序进行调度，这通常会导致系统利用率和响应速度大大降低。backifill调度将启动优先级较低的工作，前提是这样做不会延迟***优先级较高工作的预期启动时间。由于待处理工作的预期启动时间取决于运行中工作的预期完成时间，因此合理准确的时间限制对于backifill调度的良好运行非常重要。

Slurm 的backifill调度程序会考虑到每个正在运行的作业。然后，它按优先级顺序考虑待处理的作业，决定每个作业何时何地开始，并考虑到[作业抢占](https://slurm.schedmd.com/preempt.html)、[gang调度](https://slurm.schedmd.com/gang_scheduling.html)、[通用资源（GRES）要求](https://slurm.schedmd.com/gres.html)、内存要求等可能性。如果考虑中的作业可以立即启动，而不会影响任何优先级更高的作业的预期启动时间，那么它就会立即启动。否则，作业所需的资源将在作业的预期执行时间内保留。backifill插件将设置待处理工作的预计开始时间，并将这些保留节点设置为 **"计划 "** 状态。作业的预计开始时间可使用 **squeue --start** 命令查看。出于性能考虑，即使作业不需要整个节点，backifill调度程序也会为作业保留整个节点。

调度逻辑会建立一个作业-分区对的排序列表。提交给多个分区的作业在列表中的条目数与请求的分区数相同。默认情况下，backifill调度程序会评估单个作业的所有作业-分区对，可能会为每个分区对预留资源，但只会启动预留中提供最早开始时间的作业。

让单个作业为多个分区预留资源，可能会妨碍其他作业（或 hetjob 组件）预留已为分区预留的资源，因为这些分区不提供最早开始时间。如果分区中的节点重叠，而高优先级分区中的backifill预留又阻塞了低优先级分区中的节点，那么请求多个分区的单个作业也会阻止自己在低优先级分区中提前启动。

如果没有合理的作业时间限制估计，backifill调度是很困难的，但一些配置参数可以提供帮助。

- **DefaultTime** - 默认作业时限（按分区指定值）
- **MaxTime**-最大作业时限（按分区指定值）
- **OverTimeLimit** - 作业在被杀死前可超过的时间限制。全系统配置参数。

backifill调度是一项耗时的操作。每两秒会短暂释放一次锁，以便处理其他选项，例如处理新的作业提交请求。backifill调度可选择在锁释放后继续执行，并忽略新提交的作业（**SchedulerParameters=bf_continue**）。这样做将允许考虑更多作业，但可能导致新提交作业的调度延迟。与backifill调度相关的 **SchedulerParameters** 配置参数的部分列表如下。有关backifill调度的详细信息和完整列表，请参阅 slurm.conf man 页面。

- **bf_continue** - 如果设置，则在为其他操作定期释放锁后继续进行backifill调度。
- **bf_interval=#** - backifill调度尝试之间的间隔。默认值为 30 秒。
- **bf_max_job_part=#** - 每个分区在每个backifill周期内启动的最大作业数。默认值为 0（无限制）。
- **bf_max_job_start=#** - 每个backifill周期内启动的最大作业数。默认值为 0（无限制）。
- **bf_max_job_test=#** - 每个backifill周期内考虑进行backifill调度的最大作业数。默认值为 100 个作业。
- **bf_max_job_user=#** - 每个backifill周期内每个用户启动的最大作业数。默认值为 0（无限制）。
- **bf_max_time=#** - backifill调度程序在中断前可花费的最长时间（包括锁释放时的休眠时间），以秒为单位。默认值是 **bf_interval** 的值，默认为 30 秒。
- **bf_one_resv_per_job** - 禁止为每个作业添加一个以上的backifill预留。通过该选项，提交到多个分区的作业将在第一个作业-分区配对预订了backifill预订后停止预订资源。同一作业的后续作业对将只测试是否现在开始。这样，其他作业就可以预订其他配对的资源，但代价是不能保证多分区作业在提供最早开始时间的分区中开始（除非可以立即开始）。该选项默认为禁用。
- **bf_resolution=#** - backifill调度的时间分辨率。默认值为 60 秒。如果作业时间限制不精确，和/或希望小幅延迟启动待处理作业以提高系统利用率，则适合使用较大的值。
- **bf_window=#** - 在确定作业何时何地可以开始时，要考虑未来多长时间（以分钟为单位）。数值越大，开销越大，响应速度越慢。一般来说，为防止作业饿死，建议使用至少与允许的最高时限一样长的值。为了限制backifill调度程序管理的数据量，如果增加 bf_window 的值，通常建议同时增加 **bf_resolution**。默认值为 1440 分钟（一天）。
- **bf_yield_interval=#** - backifill调度程序将定期放弃锁，以便执行其他待处理操作。这指定了以微秒为单位的放弃锁的时间。默认值为 2,000,000 微秒（2 秒）。与 bf_continue 选项一起使用时，较小的值可能有助于高吞吐量计算。
- **bf_yield_sleep=#** - backifill调度程序将定期放弃锁，以便执行其他待处理操作。这指定了以微秒为单位的放弃锁的时间长度。默认值为 500,000 微秒（0.5 秒）。