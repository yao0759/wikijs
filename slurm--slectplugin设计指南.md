---
title: slurm--select plugin设计指南
description: slurm中文翻译系列，机翻后纠正了一点，发现其他错误望指出，来源：https://github.com/SchedMD/slurm/blob/master/doc/html/select_design.shtml
published: true
date: 2024-06-29T06:18:57.111Z
tags: slurm
editor: markdown
dateCreated: 2024-06-29T06:16:14.902Z
---

# select plugin设计指南

## 概述

选择插件负责选择要分配给作业的计算资源，以及分配和取消分配这些资源。根据拓扑插件建立的数据结构，选择插件可了解系统拓扑结构。如果进行了配置，它还可以超量订阅资源，以支持帮派调度（并行作业的时间切分）。其他架构将依赖于**select/linear**或**select/cons_tres**插件。**select/linear** 插件为作业分配整个节点，是最简单的实现方式。**select/cons_tres**插件（**cons_tres**是可跟踪资源的缩写）可以在节点内分配单个插座、内核、线程或 CPU。它还能管理 GPU 等其他通用资源。**select/cons_tres** 插件比 **select/linear** 稍慢，但包含的逻辑要复杂得多。

## 运行模式

**select/linear**和**select/cons_tres**插件的操作模式类似。明显不同的是，**select/linear** 中的数据结构以节点为中心，而**select/cons_tres** 中的数据结构则包含分辨率更高的信息（socket、core、processor或 CPU，具体取决于**SelectTypeParameters**配置参数）。下面的描述是通用的，适用于上述两个插件的实现。请注意，每个插件都能管理内存分配。如果需要跟踪 GPU 等其他资源，则应使用 **select/cons_tres** 插件。

每个节点的数据结构包括内存（已配置和分配）、GRES（已配置和分配，在 List 数据结构中），再加上一个标志，指示节点是否已使用独占选项进行分配（防止其他作业在同一节点上分配资源）。另一个关键数据结构用于执行每个分区的 OverSubscribe 配置参数，并跟踪每个分区中每个计算资源（如 CPU）分配给了多少作业。根据资源分配的分辨率（如节点或 CPU），插件之间的数据结构有所不同。

选择插件中的大部分逻辑都用于识别要分配给新作业的资源。该函数的输入包括：指向新作业的指针、标识可使用节点的位图、节点计数（最小、最大和期望）、该作业可与多少个分区的作业共享资源的计数，以及可抢先启动新作业的作业列表。第一阶段是确定在所有可用节点中，哪些节点最能满足资源需求。这包括一个最佳匹配算法，根据网络拓扑（如果配置了 **topology/tree** 插件）或连续节点（默认情况下）对节点进行分组。一旦确定了最佳节点，就会为新任务积累资源，直到满足其资源需求。

如果当前可用资源无法启动作业，插件将尝试识别可以抢先启动的作业，以便启动新作业。将创建当前系统状态的副本，其中包括所有资源和活动作业的详细信息。然后，可抢占的工作将从该模拟系统状态中移除，直到新工作可以启动为止。当新作业有足够的资源时，实际需要抢占的作业将被抢占（这可能是模拟抢占的作业的子集）。

其他函数还支持暂停作业、恢复作业、终止作业、缩减作业分配、**un/packing**作业状态信息、卸载/打包节点状态信息等。这些函数的操作相对简单，在此不再详述。